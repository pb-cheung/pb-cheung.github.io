<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>diff算法 | pb&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.64f7ac41.css" as="style"><link rel="preload" href="/assets/js/app.6adad53f.js" as="script"><link rel="preload" href="/assets/js/2.d771c900.js" as="script"><link rel="preload" href="/assets/js/12.f73874c3.js" as="script"><link rel="prefetch" href="/assets/js/10.dcde2f5e.js"><link rel="prefetch" href="/assets/js/11.cff281d7.js"><link rel="prefetch" href="/assets/js/13.408827ee.js"><link rel="prefetch" href="/assets/js/14.c13eb0bf.js"><link rel="prefetch" href="/assets/js/15.aac1e0de.js"><link rel="prefetch" href="/assets/js/16.1ac13363.js"><link rel="prefetch" href="/assets/js/17.d7f38cf9.js"><link rel="prefetch" href="/assets/js/18.fecb3b89.js"><link rel="prefetch" href="/assets/js/19.6263e4b6.js"><link rel="prefetch" href="/assets/js/20.475ad2cf.js"><link rel="prefetch" href="/assets/js/21.ca24da62.js"><link rel="prefetch" href="/assets/js/22.7885ef4e.js"><link rel="prefetch" href="/assets/js/23.8cd8e281.js"><link rel="prefetch" href="/assets/js/24.8ce99c1e.js"><link rel="prefetch" href="/assets/js/25.d4df532e.js"><link rel="prefetch" href="/assets/js/26.94dd1d58.js"><link rel="prefetch" href="/assets/js/27.fc3dc632.js"><link rel="prefetch" href="/assets/js/28.17b0c1c7.js"><link rel="prefetch" href="/assets/js/29.2bd08fe5.js"><link rel="prefetch" href="/assets/js/3.5e967577.js"><link rel="prefetch" href="/assets/js/30.5deab225.js"><link rel="prefetch" href="/assets/js/31.57cc0a2f.js"><link rel="prefetch" href="/assets/js/32.bbc7fa3f.js"><link rel="prefetch" href="/assets/js/33.e3181517.js"><link rel="prefetch" href="/assets/js/34.c283b275.js"><link rel="prefetch" href="/assets/js/35.c442fc47.js"><link rel="prefetch" href="/assets/js/36.1d4ee7e7.js"><link rel="prefetch" href="/assets/js/37.abedfcc0.js"><link rel="prefetch" href="/assets/js/38.e1bcb9b4.js"><link rel="prefetch" href="/assets/js/39.ee95046d.js"><link rel="prefetch" href="/assets/js/4.42e55058.js"><link rel="prefetch" href="/assets/js/40.cf50a7de.js"><link rel="prefetch" href="/assets/js/41.fe3c2ab8.js"><link rel="prefetch" href="/assets/js/42.7150dbb2.js"><link rel="prefetch" href="/assets/js/43.200a80ea.js"><link rel="prefetch" href="/assets/js/44.4103f9fc.js"><link rel="prefetch" href="/assets/js/45.93188eba.js"><link rel="prefetch" href="/assets/js/46.1364e4fb.js"><link rel="prefetch" href="/assets/js/47.672cb232.js"><link rel="prefetch" href="/assets/js/48.36ee6e48.js"><link rel="prefetch" href="/assets/js/49.6c80d33c.js"><link rel="prefetch" href="/assets/js/5.75bf1593.js"><link rel="prefetch" href="/assets/js/50.d8d9d449.js"><link rel="prefetch" href="/assets/js/51.dff07c80.js"><link rel="prefetch" href="/assets/js/52.86cec1ee.js"><link rel="prefetch" href="/assets/js/53.012b7309.js"><link rel="prefetch" href="/assets/js/54.54c5d024.js"><link rel="prefetch" href="/assets/js/55.38e297b3.js"><link rel="prefetch" href="/assets/js/56.d359a5da.js"><link rel="prefetch" href="/assets/js/57.46464366.js"><link rel="prefetch" href="/assets/js/58.d9cd1646.js"><link rel="prefetch" href="/assets/js/59.6558ee37.js"><link rel="prefetch" href="/assets/js/6.6592b8e9.js"><link rel="prefetch" href="/assets/js/60.5885e73b.js"><link rel="prefetch" href="/assets/js/61.72117488.js"><link rel="prefetch" href="/assets/js/62.dd0d9886.js"><link rel="prefetch" href="/assets/js/63.09e70e26.js"><link rel="prefetch" href="/assets/js/64.ffb070c4.js"><link rel="prefetch" href="/assets/js/65.39ab6c41.js"><link rel="prefetch" href="/assets/js/66.f519c6c9.js"><link rel="prefetch" href="/assets/js/67.fe09efe2.js"><link rel="prefetch" href="/assets/js/68.87fcd61c.js"><link rel="prefetch" href="/assets/js/69.9fe94e2c.js"><link rel="prefetch" href="/assets/js/7.0d15b0ac.js"><link rel="prefetch" href="/assets/js/70.a2dd26a6.js"><link rel="prefetch" href="/assets/js/71.45df84f5.js"><link rel="prefetch" href="/assets/js/72.57a9b07e.js"><link rel="prefetch" href="/assets/js/73.1e1c769b.js"><link rel="prefetch" href="/assets/js/74.5e95132b.js"><link rel="prefetch" href="/assets/js/75.873e3f1a.js"><link rel="prefetch" href="/assets/js/76.60c9b187.js"><link rel="prefetch" href="/assets/js/77.e46b2efc.js"><link rel="prefetch" href="/assets/js/78.e392cfd2.js"><link rel="prefetch" href="/assets/js/79.5683df7b.js"><link rel="prefetch" href="/assets/js/8.edffb30a.js"><link rel="prefetch" href="/assets/js/80.5110ea04.js"><link rel="prefetch" href="/assets/js/81.d30dc885.js"><link rel="prefetch" href="/assets/js/82.08ff2739.js"><link rel="prefetch" href="/assets/js/83.1b780844.js"><link rel="prefetch" href="/assets/js/84.660c535c.js"><link rel="prefetch" href="/assets/js/85.a8a22ed3.js"><link rel="prefetch" href="/assets/js/86.25b5de01.js"><link rel="prefetch" href="/assets/js/87.639800f4.js"><link rel="prefetch" href="/assets/js/88.09031d68.js"><link rel="prefetch" href="/assets/js/89.37e4788b.js"><link rel="prefetch" href="/assets/js/9.8503bb9a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.64f7ac41.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">pb's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/js-ref/new操作符.html" class="nav-link">
  深入理解JS
</a></div><div class="nav-item"><a href="/coding/coding.html" class="nav-link">
  编码
</a></div><div class="nav-item"><a href="/interview/http.html" class="nav-link">
  前端面试
</a></div><div class="nav-item"><a href="/vue/questions.html" class="nav-link">
  Vue.js
</a></div><div class="nav-item"><a href="/algorithm/dichotomy.html" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/style/sass.html" class="nav-link">
  布局
</a></div><div class="nav-item"><a href="/nodejs/nodejs内存管理.html" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/ai/llm.html" class="nav-link">
  AI
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/js-ref/new操作符.html" class="nav-link">
  深入理解JS
</a></div><div class="nav-item"><a href="/coding/coding.html" class="nav-link">
  编码
</a></div><div class="nav-item"><a href="/interview/http.html" class="nav-link">
  前端面试
</a></div><div class="nav-item"><a href="/vue/questions.html" class="nav-link">
  Vue.js
</a></div><div class="nav-item"><a href="/algorithm/dichotomy.html" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/style/sass.html" class="nav-link">
  布局
</a></div><div class="nav-item"><a href="/nodejs/nodejs内存管理.html" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/ai/llm.html" class="nav-link">
  AI
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">首页</a></li><li><a href="/vue/questions.html" class="sidebar-link">Vue面试题</a></li><li><a href="/vue/computed.html" class="sidebar-link">Computed（计算属性）原理</a></li><li><a href="/vue/watch.html" class="sidebar-link">watch（侦听器）原理</a></li><li><a href="/vue/lifecycle.html" class="sidebar-link">生命周期</a></li><li><a href="/vue/component.html" class="sidebar-link">Vue组件化</a></li><li><a href="/vue/slot.html" class="sidebar-link">插槽</a></li><li><a href="/vue/Vue3-reactivity.html" class="sidebar-link">Vue3响应式</a></li><li><a href="/vue/reactivity.html" class="sidebar-link">响应式原理</a></li><li><a href="/vue/compile-template.html" class="sidebar-link">Vue模板编译</a></li><li><a href="/vue/diff.html" aria-current="page" class="active sidebar-link">diff算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/diff.html#虚拟dom" class="sidebar-link">虚拟DOM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/diff.html#如何获取" class="sidebar-link">如何获取</a></li><li class="sidebar-sub-header"><a href="/vue/diff.html#与ast比较" class="sidebar-link">与AST比较</a></li></ul></li><li class="sidebar-sub-header"><a href="/vue/diff.html#patch函数" class="sidebar-link">patch函数</a></li><li class="sidebar-sub-header"><a href="/vue/diff.html#patchvnode函数" class="sidebar-link">patchVNode函数</a></li><li class="sidebar-sub-header"><a href="/vue/diff.html#updatechildren函数" class="sidebar-link">updateChildren函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/diff.html#_1-oldstart、newstart指向节点相同" class="sidebar-link">1.oldStart、newStart指向节点相同</a></li><li class="sidebar-sub-header"><a href="/vue/diff.html#_2-oldend、newend指向节点相同" class="sidebar-link">2.oldEnd、newEnd指向节点相同？</a></li><li class="sidebar-sub-header"><a href="/vue/diff.html#_3-oldstart-newend指向节点相同-交叉比较" class="sidebar-link">3.oldStart/newEnd指向节点相同？（交叉比较）</a></li><li class="sidebar-sub-header"><a href="/vue/diff.html#_4-oldend-newstart指向节点相同-反向交叉" class="sidebar-link">4.oldEnd/newStart指向节点相同？（反向交叉）</a></li><li class="sidebar-sub-header"><a href="/vue/diff.html#_5-映射表查找" class="sidebar-link">5.映射表查找</a></li><li class="sidebar-sub-header"><a href="/vue/diff.html#while结束后" class="sidebar-link">while结束后</a></li><li class="sidebar-sub-header"><a href="/vue/diff.html#伪代码" class="sidebar-link">伪代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/vue/diff.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/vue/nextTick.html" class="sidebar-link">Vue异步更新</a></li><li><a href="/vue/communication.html" class="sidebar-link">组件间通信</a></li><li><a href="/vue/scoped-css.html" class="sidebar-link">scoped</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="diff算法"><a href="#diff算法" class="header-anchor">#</a> diff算法</h1> <p>从Vue初始化过程看diff所在的阶段</p> <p><code>编译模板</code> =&gt; <code>执行render函数</code> =&gt; <code>比较新旧虚拟DOM树</code> =&gt; <code>更新，生成真实节点</code></p> <p>diff位于处在第三个阶段，是新、旧两个虚拟节点树进行diff。</p> <h2 id="虚拟dom"><a href="#虚拟dom" class="header-anchor">#</a> 虚拟DOM</h2> <p>虚拟DOM=<code>VNode</code>，它的数据结构：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">vnode</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> componentOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        vm<span class="token punctuation">,</span>
        tag<span class="token punctuation">,</span>
        key<span class="token punctuation">,</span>
        data<span class="token punctuation">,</span>
        children<span class="token punctuation">,</span>
        text<span class="token punctuation">,</span>
        componentOptions<span class="token punctuation">,</span> <span class="token comment">// 组件的构造函数</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>它是一个对象，包含了vum实例、标签名、key、data（属性），子元素、文本等属性。</p> <h3 id="如何获取"><a href="#如何获取" class="header-anchor">#</a> 如何获取</h3> <p>虚拟DOM是通过render函数执行得到的，render函数运行，其中的<code>_c</code>、<code>_v</code>会调用创建VNode的方法。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// _c('div', {}, ...children)</span>
    <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_c</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">createElementVNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// _v(text)</span>
    <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_v</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">createTextVNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="与ast比较"><a href="#与ast比较" class="header-anchor">#</a> 与AST比较</h3> <p>从<a href="/vue/compile-template.html">Vue模板编译</a>章节，我们了解了AST也是对象，VNode和AST节点较为相似，有很多相同的属性。</p> <ul><li>虚拟DOM：描述的是DOM元素，可以随意增加属性（vue实例、指令、插槽等等）</li> <li>AST：是语法层面的转换，格式固定，只能是HTML+CSS原生有的内容</li></ul> <h2 id="patch函数"><a href="#patch函数" class="header-anchor">#</a> patch函数</h2> <p>patch函数对应这两个阶段：<code>比较新旧虚拟DOM树</code> =&gt; <code>更新，生成真实节点</code>，我们要研究的diff算法也在其内部。</p> <p>它接收两个参数:<code>patch(oldVNode, vnode)</code>，分别是旧虚拟DOM树，新虚拟DOM树。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter">oldVNode<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldVNode<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 组件的挂载</span>
        <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// vm.$el 对应的就是组件的渲染结果</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 初渲染流程</span>
    <span class="token keyword">const</span> isRealElement <span class="token operator">=</span> oldVNode <span class="token operator">&amp;&amp;</span> oldVNode<span class="token punctuation">.</span>nodeType<span class="token punctuation">;</span> <span class="token comment">// 是否是真实的DOM元素(nodeType是原生属性)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isRealElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> elm <span class="token operator">=</span> oldVNode<span class="token punctuation">;</span> <span class="token comment">// 获取真实元素</span>
        <span class="token keyword">const</span> parentElm <span class="token operator">=</span> oldVNode<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span> <span class="token comment">// 获取其父元素</span>
        <span class="token keyword">let</span> newElm <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// console.log(newElm);</span>
        parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>newElm<span class="token punctuation">,</span> elm<span class="token punctuation">.</span>nextSibling<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 插入新节点</span>
        parentElm<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 删除老节点</span>
        <span class="token keyword">return</span> newElm<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 执行diff</span>
        <span class="token keyword">return</span> <span class="token function">patchVNode</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>解释：</p> <p>几个判断分支</p> <ul><li><code>oldVNode</code>不存在，<code>vnode</code>转换为真实DOM，新增</li> <li>如果<code>oldVNode</code>是真实dom不是虚拟节点（对应首次渲染的情况），把<code>vnode</code>转换为真实DOM挂载到<code>oldVNode</code>；</li> <li>如果两个参数都是虚拟DOM，则调用<code>patchVNode</code>，进行<code>diff</code>比对</li></ul> <h2 id="patchvnode函数"><a href="#patchvnode函数" class="header-anchor">#</a> patchVNode函数</h2> <p>patchVNode函数开始就是diff算法的具体实现</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">patchVNode</span><span class="token punctuation">(</span><span class="token parameter">oldVNode<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. 两个节点是不是同一个节点，直接删除重建</span>
    <span class="token comment">// 2. 两个节点是同一个节点（通过节点的tag和key），比较节点的属性是否有差异（复用老的节点，将差异的属性更新）</span>
    <span class="token comment">// 3. 节点比较完之后比较儿子</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isSameVNode</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> el <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        oldVNode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span>oldVNode<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> el<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 文本的情况</span>
    vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> oldVNode<span class="token punctuation">.</span>el<span class="token punctuation">;</span> <span class="token comment">// 复用老节点的元素</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldVNode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVNode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            oldVNode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>textNode <span class="token operator">=</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">;</span> <span class="token comment">// 用新的文本替换老的</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 是标签 比对标签的属性</span>
    <span class="token function">patchProps</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> oldVNode<span class="token punctuation">.</span>data<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 比较儿子</span>
    <span class="token comment">// 一方有儿子，一方没有</span>
    <span class="token keyword">let</span> oldChildren <span class="token operator">=</span> oldVNode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> newChildren <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> el <span class="token operator">=</span> oldVNode<span class="token punctuation">.</span>el<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldChildren<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> newChildren<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 双方都有</span>
        <span class="token function">updateChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> oldChildren<span class="token punctuation">,</span> newChildren<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newChildren<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 老没有，新有</span>
        <span class="token function">mountChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> newChildren<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldChildren<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 老有，新没有 删除</span>
        el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// 可以循环删除</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> el<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>解释：</p> <ul><li>两个虚拟DOM是同个节点？，判断的方法就是看是否<strong>标签名和key都要相同</strong> <ul><li>如果不是相同节点，则<code>vnode</code>创建真实节点替换挂载</li> <li>如果是相同节点，继续流程</li></ul></li> <li>文本节点？如果是用<code>vnode</code>的文本替换<code>oldVNode</code>的文本。</li> <li>处理属性</li> <li>处理儿子节点
<ul><li>oldchildren没有，<code>newChildren</code>有，挂载新的儿子几点</li> <li>oldchildren有，<code>newChildren</code>没有，删除<code>oldchildren</code></li> <li>都有。<code>updateChildren</code>函数处理</li></ul></li></ul> <h2 id="updatechildren函数"><a href="#updatechildren函数" class="header-anchor">#</a> updateChildren函数</h2> <p>定义4个指针，分别指向oldChildren头尾子节点、newChildren头尾子节点</p> <p><img src="/assets/img/diff-pointer.ef0caa85.png" alt="4个指针"></p> <p>函数主要内容是一个循环体，循环结束条件是同个列表上的前指针跑到了后指针的后面发生交叉或者指向了同个元素。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">while</span> <span class="token punctuation">(</span>oldStartIndex <span class="token operator">&lt;=</span> oldEndIndex <span class="token operator">&amp;&amp;</span> newStartIndex <span class="token operator">&lt;=</span> newEndIndex）<span class="token punctuation">{</span> <span class="token comment">// 头指针尾指针重合，则结束循环</span>
<span class="token punctuation">}</span>
</code></pre></div><p>while循环体是一系列条件判断:：</p> <h3 id="_1-oldstart、newstart指向节点相同"><a href="#_1-oldstart、newstart指向节点相同" class="header-anchor">#</a> 1.oldStart、newStart指向节点相同</h3> <p>如果相同</p> <ul><li>a. 调用<code>patchVNode</code>比较细节</li> <li>b. 两个指针分别向后移动一位
不同，进入以下分支</li></ul> <h3 id="_2-oldend、newend指向节点相同"><a href="#_2-oldend、newend指向节点相同" class="header-anchor">#</a> 2.oldEnd、newEnd指向节点相同？</h3> <p>相同</p> <ul><li>a. 调用<code>patchVNode</code>比较细节</li> <li>b. 两个指针分别向前移动一位
不同，进入以下分支</li></ul> <h3 id="_3-oldstart-newend指向节点相同-交叉比较"><a href="#_3-oldstart-newend指向节点相同-交叉比较" class="header-anchor">#</a> 3.oldStart/newEnd指向节点相同？（交叉比较）</h3> <p><img src="/assets/img/diff-oldstart-newend.8d827bae.gif" alt=""></p> <p>相同</p> <ul><li>a.调用<code>patchVNode</code>比较细节</li> <li>b.将oldStart节点移动到oldEnd后面（节点复用）</li> <li>c.<code>oldStartIndex</code>向后移动一位，<code>newEndIndex</code>向前移动一位
不同，进入以下分支</li></ul> <h3 id="_4-oldend-newstart指向节点相同-反向交叉"><a href="#_4-oldend-newstart指向节点相同-反向交叉" class="header-anchor">#</a> 4.oldEnd/newStart指向节点相同？（反向交叉）</h3> <p>相同</p> <ul><li>a.调用<code>patchVNode</code>比较细节</li> <li>b.将<code>oldEnd</code>节点移动到<code>oldStart</code>前面（节点复用）</li> <li>c.<code>oldEndIndex</code>向前移动一位，<code>newStartIndex</code>向后移动一位
不同，进入以下分支</li></ul> <h3 id="_5-映射表查找"><a href="#_5-映射表查找" class="header-anchor">#</a> 5.映射表查找</h3> <p>以上4种情况（大概的正序、逆序基础上的增删）都未能命中，可能是乱序的情况。针对这种情况则根据映射表查找。针对<code>newStartIndex</code>指向的节点，从<code>oldChildren</code>剩余的节点中寻找相同的。</p> <p>根据老的列表做一个映射表，用新的去查找，找不到则添加，最后多余的就删除</p> <ul><li>a.构建<code>oldChildren</code>的<code>key</code>-<code>index</code>映射表:</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">makeIndexByKey</span><span class="token punctuation">(</span><span class="token parameter">children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            map<span class="token punctuation">[</span>child<span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> index<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token function">makeIndexByKey</span><span class="token punctuation">(</span>oldChildren<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>b. 在映射表中，用<code>newStartIndex</code>指向节点(<code>newStartVNode</code>)的<code>key</code>去查找。
<ul><li>如果有对应的index，说明<code>oldChildren</code>上存在可复用的节点。
<ul><li>移动节点到<code>oldChildren</code>末尾</li> <li><code>oldChildren</code>索引对应的点置为<code>undefined</code></li> <li>执行<code>patchVNode</code>比较属性和子节点</li></ul></li> <li>如果没有，说明没有可复用的节点
<ul><li>创建真实节点，插入到<code>oldChildren</code>最后</li></ul></li></ul></li></ul> <h3 id="while结束后"><a href="#while结束后" class="header-anchor">#</a> while结束后</h3> <p>两个列表的指针肯定有某一对发生了重叠或交叉</p> <p><img src="/assets/img/diff-after-while.1ea3f4e6.png" alt=""></p> <h4 id="_1-新列表的指针发生交叉"><a href="#_1-新列表的指针发生交叉" class="header-anchor">#</a> 1.新列表的指针发生交叉</h4> <p>旧列表还有剩余，说明新的发生了删减，把旧列表剩余的删除</p> <h4 id="_2-旧列表的指针发生交叉"><a href="#_2-旧列表的指针发生交叉" class="header-anchor">#</a> 2.旧列表的指针发生交叉</h4> <p>新列表还有剩余，说明新列表有新增，</p> <p>遍历新列表剩余的子元素，创建真实节点，插入末尾</p> <h3 id="伪代码"><a href="#伪代码" class="header-anchor">#</a> 伪代码</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> oldChildren<span class="token punctuation">,</span> newChildren</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> oldStartIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> newStartIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> oldEndIndex <span class="token operator">=</span> oldChildren<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> newEndIndex <span class="token operator">=</span> newChildren<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> oldStartVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>oldStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> newStartVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>newStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> oldEndVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>oldEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> newEndVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>newEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">makeIndexByKey</span><span class="token punctuation">(</span><span class="token parameter">children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            map<span class="token punctuation">[</span>child<span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> index<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token function">makeIndexByKey</span><span class="token punctuation">(</span>oldChildren<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span>oldStartIndex <span class="token operator">&lt;=</span> oldEndIndex <span class="token operator">&amp;&amp;</span> newStartIndex <span class="token operator">&lt;=</span> newEndIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 头指针尾指针重合，则结束循环</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldStartVNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            oldStartVNode <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">++</span>oldStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldEndVNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            oldEndVNode <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">--</span>oldEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSameVNode</span><span class="token punctuation">(</span>oldStartVNode<span class="token punctuation">,</span> newStartVNode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 比较开头节点</span>
            <span class="token function">patchVNode</span><span class="token punctuation">(</span>oldStartVNode<span class="token punctuation">,</span> newStartVNode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果是相同节点，递归比较子节点</span>
            oldStartVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 移动指针</span>
            newStartVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span><span class="token operator">++</span>newStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSameVNode</span><span class="token punctuation">(</span>oldEndVNode<span class="token punctuation">,</span> newEndVNode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 比较末尾节点</span>
            <span class="token function">patchVNode</span><span class="token punctuation">(</span>oldEndVNode<span class="token punctuation">,</span> newEndVNode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果是相同节点，递归比较子节点</span>
            oldEndVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 移动指针</span>
            newEndVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span><span class="token operator">--</span>newEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isSameVNode</span><span class="token punctuation">(</span>oldEndVNode<span class="token punctuation">,</span> newStartVNode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 交叉对比——旧后和新前  abcd -&gt; dabc</span>
            <span class="token function">patchVNode</span><span class="token punctuation">(</span>oldEndVNode<span class="token punctuation">,</span> newStartVNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            el<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldEndVNode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> oldStartVNode<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将老的尾巴移到老的前面去</span>
            oldEndVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
            newStartVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span><span class="token operator">++</span>newStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isSameVNode</span><span class="token punctuation">(</span>oldStartVNode<span class="token punctuation">,</span> newEndVNode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 交叉对比——旧前和新后 abcd -&gt; bcda</span>
            <span class="token function">patchVNode</span><span class="token punctuation">(</span>oldStartVNode<span class="token punctuation">,</span> newEndVNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            el<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldStartVNode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> oldEndVNode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>nextSibling<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将老的头移到老的尾巴后面去</span>
            oldStartVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
            newEndVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span><span class="token operator">--</span>newEndIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 乱序的情况，使用映射表 a,b,c =&gt; b,m,a,p,c,q</span>
            <span class="token comment">// 根据老的列表做一个映射表，用新的去查找，找不到则添加，最后多余的就删除</span>
            <span class="token keyword">let</span> moveIndex <span class="token operator">=</span> map<span class="token punctuation">[</span>newStartVNode<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 如果有值，则说明是当前需要移动的索引</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>moveIndex <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> moveVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>moveIndex<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 找到对应的虚拟几点复用</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moveVNode<span class="token punctuation">,</span> oldStartVNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
                el<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>moveVNode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> oldStartVNode<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>

                oldChildren<span class="token punctuation">[</span>moveIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// 表示这个几点已经移走了</span>
                <span class="token function">patchVNode</span><span class="token punctuation">(</span>moveVNode<span class="token punctuation">,</span> newStartVNode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 比对属性和子节点</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 旧的中没找到</span>
                el<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>newStartVNode<span class="token punctuation">)</span><span class="token punctuation">,</span> oldStartVNode<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            newStartVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span><span class="token operator">++</span>newStartIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 给动态列表添加key的时候，要尽量避免用索引（新旧列表索引都是从0开始），可能会发生错误复用</span>
        <span class="token comment">// arr: ['a', 'b', 'c'] =&gt; arr: ['d', 'a', 'b', 'c']</span>
        <span class="token comment">// 标签名不变，新arr第一个元素的key和旧arr第一个元素的key都为0，认为是同个元素</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 遍历完整之后的逻辑</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newStartIndex <span class="token operator">&lt;=</span> newEndIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// newChildren还有剩余，则添加到树上</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> newStartIndex<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> newEndIndex<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> childEl <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 可能是向后增加，也可能是向前增加</span>
            <span class="token keyword">let</span> anchor <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>newEndIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">?</span> newChildren<span class="token punctuation">[</span>newEndIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>el <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token comment">// el.appendChild(childEl);</span>
            el<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>childEl<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// anchor为null时则会认为是appendChild</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartIndex <span class="token operator">&lt;=</span> oldEndIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// oldChildren还有剩余，从树上删除</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> oldStartIndex<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> oldEndIndex<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> childEl <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>el<span class="token punctuation">;</span>
                el<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>childEl<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <p><a href="https://juejin.cn/post/6971622260490797069" target="_blank" rel="noopener noreferrer">图文并茂地来详细讲讲Vue Diff算法|掘金<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue/compile-template.html" class="prev">
        Vue模板编译
      </a></span> <span class="next"><a href="/vue/nextTick.html">
        Vue异步更新
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6adad53f.js" defer></script><script src="/assets/js/2.d771c900.js" defer></script><script src="/assets/js/12.f73874c3.js" defer></script>
  </body>
</html>
